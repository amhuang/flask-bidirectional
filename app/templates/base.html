<html>
    <head>
      {% if title %}
      <title>{{ title }} - Microblog</title>
      {% else %}
      <title>Welcome to Microblog</title>
      {% endif %}
      <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js" type="text/javascript"></script>
    </head>
    <body>
        <div>Microblog: <a href="/index">Home</a></div>
        <hr>
        {% block content %}{% endblock %}
    </body>
    
    <script>
      var host = "127.0.0.1";
      var port = 8000;

      function onConnect() {
        console.log("Connected");
        mqtt.subscribe("home");
        var msg = new Paho.MQTT.Message("Hello World");
        msg.destinationName("Home");
      }

      function onMessageArrived(message) {
        let msg = message.payloadString;
        let topic = message.destinationName;
        document.write("New message" + msg);
      }
      
      function mqttConnect() {
        console.log("connecting to " + host + ":" + port);
        mqtt = new Paho.MQTT.Client(host, port, "clientjs");
        mqtt.onMessageArrived = onMessageArrived;
        document.write("Connecting to " + host);
        var options = {
          timeout: 5,
          onSuccess: onConnect,
        };

        mqtt.connect(options);
        
      }
      mqttConnect();
    </script>
</html>